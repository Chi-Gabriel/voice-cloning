<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qwen-TTS Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css?v=2.1">
    <!-- Wavesurfer.js for audio visualization -->
    <script src="https://unpkg.com/wavesurfer.js@7"></script>
</head>

<body>
    <div class="app-container">
        <!-- Sidebar / Navigation -->
        <nav class="sidebar">
            <div class="logo">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
                <span>Qwen-TTS</span>
            </div>

            <div class="nav-links">
                <button class="nav-item active" data-tab="voice-design">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                        <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                    </svg>
                    Voice Design
                </button>
                <button class="nav-item" data-tab="voice-clone">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                    </svg>
                    Voice Cloning
                </button>
                <button class="nav-item" data-tab="custom-voice">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                    Custom Voice
                </button>
                <button class="nav-item" data-tab="asr-view">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                        <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                        <line x1="12" y1="19" x2="12" y2="23"></line>
                        <line x1="8" y1="23" x2="16" y2="23"></line>
                        <polyline points="22 2 15 22 11 13 2 9 22 2"></polyline>
                    </svg>
                    Transcription
                </button>
            </div>

            <div class="api-key-section">
                <label for="api-key-input">API Key</label>
                <input type="password" id="api-key-input" placeholder="Enter x-api-key">
            </div>
        </nav>

        <!-- Main Content Area -->
        <main class="main-content">

            <!-- Batch Queue Section (Hidden by default until items added) -->
            <div id="batch-queue-container" class="queue-container" style="display: none;">
                <div class="queue-header">
                    <h2>Batch Queue <span id="queue-count" class="badge">0</span></h2>
                    <div class="queue-actions">
                        <button id="btn-clear-queue" class="btn-text">Clear All</button>
                        <button id="btn-run-batch" class="btn-primary btn-small">Run Batch</button>
                    </div>
                </div>
                <div id="batch-list" class="queue-list">
                    <!-- Queue items injected here -->
                </div>
            </div>

            <!-- Voice Design View -->
            <div id="voice-design" class="tab-content active">
                <header>
                    <h1>Voice Design</h1>
                    <p>Generate speech from text with specific instructions.</p>
                </header>

                <div class="card">
                    <div class="form-group">
                        <label>Text to Speak</label>
                        <textarea id="vd-text" rows="3"
                            placeholder="Enter the text you want the AI to speak..."></textarea>
                    </div>

                    <div class="row">
                        <div class="form-group col">
                            <label>Instruction (Prompt)</label>
                            <input type="text" id="vd-instruct" placeholder="e.g., Happy, Sad, Excited, Whisper">
                        </div>
                        <div class="form-group col-small">
                            <label>Language</label>
                            <select id="vd-language"></select> <!-- Populated by JS -->
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Temperature: <span id="vd-temp-value">0.3</span></label>
                        <input type="range" id="vd-temperature" min="0.1" max="1.5" step="0.1" value="0.3"
                            class="slider">
                        <small style="color: var(--text-muted);">Lower = more stable, Higher = more
                            expressive/random</small>
                    </div>

                    <div class="row">
                        <button class="btn-secondary col" id="btn-add-batch-design">
                            + Add to Batch
                        </button>
                        <button class="btn-primary col" id="btn-generate-design">
                            Generate Audio
                        </button>
                    </div>
                </div>
            </div>

            <!-- Voice Cloning View -->
            <div id="voice-clone" class="tab-content">
                <header>
                    <h1>Voice Cloning</h1>
                    <p>Clone a voice using a reference audio file.</p>
                </header>

                <div class="card">
                    <!-- Section: Reference Audio -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label>Reference Audio</label>
                        <div class="file-drop-area" id="vc-drop-area">
                            <span class="fake-btn">Choose file</span>
                            <span class="file-msg">or drag and drop here</span>
                            <input class="file-input" type="file" id="vc-file" accept="audio/*">
                        </div>
                        <audio id="vc-preview" controls style="display:none; width: 100%; margin-top: 15px;"></audio>
                    </div>

                    <!-- Section: Text to Speak -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label>Text to Speak</label>
                        <textarea id="vc-text" rows="4"
                            placeholder="Enter text for the cloned voice to speak..."></textarea>
                    </div>

                    <!-- Section: Settings Row (Language & Temperature) -->
                    <div class="row" style="margin-bottom: 24px; align-items: flex-end;">
                        <div class="form-group col">
                            <label>Language</label>
                            <select id="vc-language"></select>
                        </div>
                        <div class="form-group col">
                            <label>Temperature: <span id="vc-temp-value">0.3</span></label>
                            <input type="range" id="vc-temperature" min="0.1" max="1.5" step="0.1" value="0.3"
                                class="slider">
                        </div>
                    </div>

                    <!-- Section: Enhanced Mode (Premium Layout) -->
                    <div class="form-group setting-row" style="margin-bottom: 24px;">
                        <div class="setting-info">
                            <label for="vc-enhanced">Enhanced Audio Pipeline</label>
                            <small class="text-muted">High-quality resampling & noise removal (DeepFilterNet)</small>
                        </div>
                        <label class="switch">
                            <input type="checkbox" id="vc-enhanced">
                            <span class="slider-toggle"></span>
                        </label>
                    </div>

                    <!-- Section: Reference Text (Optional) -->
                    <div class="form-group" style="margin-bottom: 24px;">
                        <label>Reference Text (Optional)</label>
                        <input type="text" id="vc-ref-text"
                            placeholder="Highly recommended: Transcript of the reference audio">
                        <small style="color: var(--text-muted); display: block; margin-top: 4px;">Improves word accuracy
                            significantly.</small>
                    </div>

                    <!-- Section: Action Buttons -->
                    <div class="row">
                        <button class="btn-secondary col" id="btn-add-batch-clone">
                            Add to Batch
                        </button>
                        <button class="btn-primary col" id="btn-generate-clone">
                            Clone Voice
                        </button>
                    </div>
                </div>
            </div>

            <!-- Custom Voice View -->
            <div id="custom-voice" class="tab-content">
                <header>
                    <h1>Custom Voice</h1>
                    <p>Use pre-defined system voices.</p>
                </header>
                <div class="card">
                    <div class="form-group">
                        <label>Text to Speak</label>
                        <textarea id="cv-text" rows="3" placeholder="Enter text..."></textarea>
                    </div>

                    <div class="row">
                        <div class="form-group col">
                            <label>Speaker ID</label>
                            <input type="text" id="cv-speaker" placeholder="e.g., Speaker_001">
                        </div>
                        <div class="form-group col-small">
                            <label>Language</label>
                            <select id="cv-language"></select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label>Instruction (Optional)</label>
                        <input type="text" id="cv-instruct" placeholder="e.g., Neutral">
                    </div>

                    <div class="form-group">
                        <label>Temperature: <span id="cv-temp-value">0.3</span></label>
                        <input type="range" id="cv-temperature" min="0.1" max="1.5" step="0.1" value="0.3"
                            class="slider">
                        <small style="color: var(--text-muted);">Lower = more stable, Higher = more
                            expressive/random</small>
                    </div>

                    <div class="row">
                        <button class="btn-secondary col" id="btn-add-batch-custom">
                            + Add to Batch
                        </button>
                        <button class="btn-primary col" id="btn-generate-custom">
                            Generate
                        </button>
                    </div>
                </div>
            </div>

            <!-- Audio Transcription View -->
            <div id="asr-view" class="tab-content">
                <header>
                    <h1>Audio Transcription</h1>
                    <p>Transcribe audio files to text using Qwen3-ASR.</p>
                </header>

                <div class="card">
                    <div class="form-group">
                        <label>Upload Audio Files</label>
                        <div class="file-drop-area" id="asr-drop-area" style="min-height: 120px;">
                            <span class="fake-btn">Choose files</span>
                            <span class="file-msg">or drag and drop multiple files here</span>
                            <input class="file-input" type="file" id="asr-files" accept="audio/*" multiple>
                        </div>
                        <audio id="asr-preview" controls style="display:none; width: 100%; margin-top: 15px;"></audio>
                    </div>

                    <div id="asr-file-list" class="file-list-container" style="display: none;">
                        <!-- Selected files will be listed here -->
                    </div>

                    <div class="row" style="margin-top: 24px;">
                        <div class="form-group col">
                            <label>Language</label>
                            <select id="asr-language"></select>
                        </div>
                        <div class="form-group col" style="display: flex; align-items: center;">
                            <label class="checkbox-container"
                                style="margin-top: 24px; cursor: pointer; display: flex; align-items: center; gap: 8px;">
                                <input type="checkbox" id="asr-timestamps">
                                <span class="checkmark"></span>
                                <span style="font-size: 0.95rem; font-weight: 500; color: var(--text-primary);">Include
                                    Timestamps</span>
                            </label>
                        </div>
                    </div>

                    <div class="row">
                        <button class="btn-secondary col" id="btn-add-batch-asr">
                            + Add to Batch
                        </button>
                        <button class="btn-primary col" id="btn-transcribe-now">
                            Transcribe Now
                        </button>
                    </div>
                </div>

                <!-- Transcription Result Area -->
                <div id="asr-result-container" class="card" style="display: none; margin-top: 20px;">
                    <h3>Transcription Result</h3>
                    <div id="asr-result-text" class="code-block"
                        style="white-space: pre-wrap; font-family: monospace; background: rgba(0,0,0,0.3); padding: 15px; border-radius: 8px; max-height: 400px; overflow-y: auto;">
                    </div>
                </div>
            </div>

            <!-- Visualizer & History -->
            <div class="output-section">
                <h2>Generated Audio</h2>
                <div class="visualizer-container">
                    <div id="waveform"></div>
                    <div class="controls">
                        <button id="play-pause" class="icon-btn" disabled>
                            <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                                <polygon points="5 3 19 12 5 21 5 3"></polygon>
                            </svg>
                        </button>
                        <div id="time-display">0:00 / 0:00</div>
                    </div>
                </div>

                <div id="history-list" class="history-list">
                    <!-- History items will appear here -->
                </div>
            </div>

        </main>
    </div>

    <!-- Scripts -->
    <script src="js/utils.js?v=2.1"></script>
    <script src="js/api.js?v=2.1"></script>
    <script src="js/ui.js?v=2.1"></script>
    <script src="js/app.js?v=2.1"></script>
</body>

</html>